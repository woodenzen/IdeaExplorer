<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <title>Zettelkasting Idea Explorer</title>
    <link rel="stylesheet" type="text/css" href="/Users/will/Dropbox/Projects/zettelkasten/IdeaExplorer/style.css">

    <script type="text/javascript">

        // Gets the KM variable with the specified name. If the variable
        // is empty and "required" is true, an exception is thrown.
        // Otherwise, the variable's value is returned,
        function getKMVariable(name, required) {
            var value = window.KeyboardMaestro.GetVariable(name);
            if (required && !value) {
                throw Error("Variable '" + name + "' not set");
            }
            return value;
        }

        // Keyboard Maestro calls this function when the window is ready.
        function KMWindow() {
            try {
                // Set the body style to the desired width and height
                document.body.style.width = getKMVariable("dspBodyWidth", true) + 'px';
                document.body.style.height = getKMVariable("dspBodyHeight", true) + 'px';

                document.title = getKMVariable("ztitle", true);

                // Setup the position and size, and return it. KM will
                // use the values to set the position and size of the
                // window. If no position has been set yet, we default it.
                // KM will parse the variable names "dspWindowWidth" and
                // "dspWindowHeight" for us.
                var lastPosition = getKMVariable("dspWindowPosition");
                if (lastPosition == '') {
                    lastPosition = "200, 200";
                }

                // Add event listener for window move
                window.addEventListener("move", saveWindowPosition);

                return lastPosition + ", dspWindowWidth, dspWindowHeight";
            } catch (e) {
                document.write("Error in KMWindow(): " + e + "<br>");
            }
        }

        //START=================================================================
            (function fixWindowScreenLocIssue() {
                Object.defineProperty(window, "screenX", {
                    get: function () {
                        return parseInt(window.KeyboardMaestro?.Calculate("WINDOW(Left)")
                            ?? window.screenX);
                    }
                });

                Object.defineProperty(window, "screenY", {
                    get: function () {
                        return parseInt(window.KeyboardMaestro?.Calculate("WINDOW(Top)")
                            ?? window.screenY);
                    }
                });
            })();
//END=================================================================

            // Save the window position to a KM variable.
            function saveWindowPosition() {
                var newPosition = window.screenX + ',' + window.screenY;
                window.KeyboardMaestro.SetVariable('dspWindowPosition', newPosition);
            }

    
        // Make sure we store our position before submitting the form.
        function submitWindow(result) {
            saveWindowPosition();
            window.KeyboardMaestro.Submit(result);
        }

        // Make sure we store our position before canceling the form.
        // NOTE: This does NOT get called when the user uses the Escape
        // key to exit the form.
        function cancelWindow(result) {
            saveWindowPosition();
            window.KeyboardMaestro.Cancel(result);
        }

        // Register an event listener to save the window position before it is closed.
        window.addEventListener('beforeunload', saveWindowPosition);

    </script>
</head>

<body>
    <div id="TablePlaceHolder" />
    <script>
        document.getElementById("TablePlaceHolder").innerHTML = window.KeyboardMaestro.GetVariable("theTable");
    </script>
    <div id="divButtons" style="text-align:center; margin-top: 10px;">
        <input type="button" value="Cancel" onclick="cancelWindow('Cancel')">
        <input type="button" value="OK" onclick="submitWindow()">
    </div>
</body>

</html>